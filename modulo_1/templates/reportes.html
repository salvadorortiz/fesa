{% extends "base.html" %}
{% load staticfiles %}
{% block title%} Reportes {% endblock %}

{% block breadcrumbs %}
   <!--  <li><a href="#">Inicio</a></li>
    <li class="active">Ingresar</li> -->
    <li>
	    <i class="fa fa-file"></i> Inicio
	</li>
    <li class="active">
        <i class="fa fa-file-o"></i> Reportes
    </li>
{% endblock %}

{% block pagetitle %}Reportes{% endblock %} 

{% block content %}
    {% load staticfiles %}
    {% csrf_token %}
    {% load widget_tweaks %}
    <hr>
        <div id="rootwizard">
        <ul class="nav nav-pills">
            <li class="active"><a href="#tab1" data-toggle="tab">Resumen complejo</a></li>
            <li><a href="#tab2" data-toggle="tab">Reporte utilidad</a></li>
            <li><a href="#tab3" data-toggle="tab">Clientes</a></li>
            <li><a href="#tab4" data-toggle="tab">Ocupación de canchas</a></li>
        </ul>
        <hr>
        <div class="tab-content">
            <div class="tab-pane active" id="tab1">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Filtrar por...</h3>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="row">
                                        <div class="col-sm-1"></div>
                                        <div class="col-sm-2">
                                            <strong>Fecha de reserva</strong>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-1"></div>
                                        <div class="col-sm-1">Desde: </div>
                                        <div class="col-sm-3">
                                            <input type="text" id="fecha_desde">
                                        </div>
                                        <div class="col-sm-1">Hasta: </div>
                                        <div class="col-sm-3">
                                            <input type="text" id="fecha_hasta">
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-sm-1"></div>
                                        <div class="col-sm-2">
                                            <strong>Seleccione un complejo</strong>
                                        </div>
                                        <div class="col-sm-3">
                                            <select class="form-control" id="cmb_complejo">
                                                {{cmb_complejo|safe}}
                                            </select>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <center>
                                                <button type="button" id="filtrar_repo_reserva" class="btn btn-success"><i class="fa fa-search"></i>&nbsp;&nbsp; Filtrar</button>
                                            </center>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div style="clear:both;margin-top:1%;padding: 5px;background-color:#337AB7">
                        <label data-toggle="collapse" href="#reserv_toggle" style="width:94%; color:white;">&nbsp;<i class="fa fa-flag"></i> &nbsp;Resumen encargado de complejo</label>
                        <a href="#" onclick="$('#dt_repo_reserva').DataTable().ajax.reload();"style="float:right; color:white;">
                            <i class="fa fa-refresh"></i>
                        </a>
                    </div>
                    <hr>
                     <div id="reserv_toggle" class="collapse in col-sm-12">
                            <table id="dt_repo_reserva" class="stripe">
                                <thead>
                                    <th>Id complejo</th>
                                    <th>Id cancha</th>
                                    <th>Id reserva de cancha </th>
                                    <th>Id reserva</th>
                                    <th>Id de forma de pago</th>
                                    <th>Fecha de reserva</th>
                                    <th>Cliente</th>
                                    <th>Nombre del evento</th>
                                    <th>Estado de la reserva</th>
                                    <th>Forma de pago</th>
                                    <th>Tipo de alquiler</th>
                                    <th>Forma de facturación</th>
                                    <th>Precio</th>
                                </thead>
                                <tbody>
                                    
                                </tbody>
                            </table>
                    </div>

            </div>
<!--xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-->
            <div class="tab-pane" id="tab2">
                <div class="row">
                    <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title">Filtrar por...</h3>
                            </div>
                            <div class="panel-body" id="panel_remesa">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-1"></div>
                                            <div class="col-sm-2">
                                                <strong>Fecha de reserva</strong>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-1"></div>
                                            <div class="col-sm-1">Desde: </div>
                                            <div class="col-sm-3">
                                                <input type="text" id="fecha_desde">
                                            </div>
                                            <div class="col-sm-1">Hasta: </div>
                                            <div class="col-sm-3">
                                                <input type="text" id="fecha_hasta">
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-sm-1"></div>
                                            <div class="col-sm-2">
                                                <strong>Seleccione un usuario</strong>
                                            </div>
                                            <div class="col-sm-3">
                                                <select class="form-control" id="cmb_usuario">
                                                    {{cmb_usuario|safe}}
                                                </select>
                                            </div>
                                        </div>
                                        <br>
                                        <div class="row">
                                            <div class="col-sm-12">
                                                <center>
                                                    <button type="button" id="filtrar_repo_remesa" class="btn btn-success"><i class="fa fa-search"></i>&nbsp;&nbsp; Filtrar</button>
                                                </center>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                </div>
                <hr>
                <div class="row">
                    <div style="clear:both;margin-top:1%;padding: 5px;background-color:#337AB7">
                        <label data-toggle="collapse" href="#remesa_toggle" style="width:94%; color:white;">&nbsp;<i class="fa fa-money"></i> &nbsp;Reporte de utilidad</label>
                        <a href="#" onclick="$('#dt_repo_remesa').DataTable().ajax.reload();"style="float:right; color:white;">
                            <i class="fa fa-refresh"></i>
                        </a>
                    </div>
                </div>

                    <hr>
                  <div class="row">    
                     <div id="remesa_toggle" class="collapse in col-sm-12">
                            <table style="width:100%" id="dt_repo_remesa" class="stripe">
                                <thead>
                                    <th>Remesa id</th>
                                    <th>Fecha</th>
                                    <th>Evento</th>
                                    <th>Cliente</th>
                                    <th>Usuario</th>
                                    <th>Precio</th>
                                    <th>Costo</th>
                                    <th>Utilidad</th>
                                    <th>Remesado</th>
                                    <th>Remanente</th>
                                    <th>Usuario</th>
                                </thead>
                                <tbody>
                                    
                                </tbody>
                            </table>
                    </div>
                </div>
                 <hr>
                 <div class="row">
                    <div class="col-sm-2"></div>
                         <div class="col-lg-8 col-md-6">
                            <div class="panel panel-primary">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-xs-3">
                                            <i class="fa fa-money fa-2x"></i>
                                        </div>
                                        <div class="col-xs-9 text-right">
                                            <div class="huge"></div>
                                            <div>Resultados totales:</div>
                                        </div>
                                    </div>
                                </div>
                                <a href="#">
                                    <div class="panel-footer">
                                         <table style="width:100%" id="dt_repo_total" class="stripe">
                                            <thead>
                                                <th>Precio total</th>
                                                <th>Costo total</th>
                                                <th>Utilidad total</th>
                                                <th>Remanente total</th>
                                            </thead>
                                            <tbody>
                                                
                                            </tbody>
                                        </table>     
                                    </div>
                                </a>
                            </div>
                        </div>
                    <div class="col-sm-2"></div>
                </div>
            </div>
 <!--xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-->           
            <div class="tab-pane" id="tab3">
                <div style="clear:both;margin-top:1%;padding: 5px;background-color:#337AB7">
                        <label data-toggle="collapse" href="#cliente_toggle" style="width:94%; color:white;">&nbsp;<i class="fa fa-flag"></i> &nbsp;Reporte de clientes</label>
                        <a href="#" onclick="$('#dt_repo_clientes').DataTable().ajax.reload();"style="float:right; color:white;">
                            <i class="fa fa-refresh"></i>
                        </a>
                    </div>
                    <hr>
                     <div id="cliente_toggle" class="collapse in col-sm-12">
                            <table style="width:100%" id="dt_repo_clientes" class="stripe">
                                <thead>
                                    <th>Tipo</th>
                                    <th>Nombre</th>
                                    <th>Ingresado por </th>
                                    <th>Primer evento</th>
                                    <th>Último evento</th>
                                </thead>
                                <tbody>
                                    
                                </tbody>
                            </table>
                    </div>
            </div>
<!--xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-->            
            <div class="tab-pane" id="tab4">
              4
            </div>
<!--xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx-->
        </div>  
    </div>

{% endblock %}

{% block addExtraScript %} 
<script type="text/javascript">
    $(window).load(function() {
	   //$('#rootwizard').bootstrapWizard({'tabClass': 'nav nav-pills'});
       $( "#fecha_desde" ).datepicker({
           // 'minDate': 0
          // altFormat: "dd-mm-yyyy"
        });
       $( "#fecha_hasta" ).datepicker({
            //altFormat: "dd-mm-yyyy"
        });

       //----Reporte de reserva
           var dt_repo_reserva = $('#dt_repo_reserva').DataTable( {
                "ajax": {
                    "url": "{%url 'repo_reserva' %}",
                    "type": "POST",
                    "data":  function( d ) {
                        d.csrfmiddlewaretoken = $("[name=csrfmiddlewaretoken]").val(),
                        d.fecha_desde= $("#fecha_desde").val(),
                        d.fecha_hasta=$("#fecha_hasta").val(),
                        d.complejo_id=$("#cmb_complejo").val()
                    },
                },
                "pageLength": 15,
                "ordering": false,
                "lengthChange": true,
                "searching": true,
                "paging": true,
                "columnDefs":[
                    {"targets":[0,1,2,3,4],"visible":false,"searchable":false},
                    {"targets":5, "width":"10%"},
                    {"targets":6, "width":"20%"},
                    {"targets":7, "width":"20%"},
                    {"targets":8, "width":"10%"},
                    {"targets":9, "width":"10%"},
                    {"targets":10, "width":"10%"},
                    {"targets":11, "width":"10%"},
                    {"targets":12, "width":"10%"},
                ],
                "language": {
                    "lengthMenu": "Mostrando _MENU_ filas por página",
                    "zeroRecords": "No se encontraron resultados",
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "Mostrando página 0 de 0",
                    "infoFiltered": "(filtered from _MAX_ total records)",
                    "oPaginate": {
                        "sNext":     "Siguiente",
                        "sPrevious": "Anterior"
                    },
                }
            });

           $("#filtrar_repo_reserva").on('click',function(){
                $("#dt_repo_reserva").DataTable().ajax.reload();
           });
        //--- Reporte de clientes
            var dt_repo_clientes = $('#dt_repo_clientes').DataTable( {
                "ajax": {
                    "url": "{%url 'repo_clientes' %}",
                    "type": "POST",
                    "data":  function( d ) {
                        d.csrfmiddlewaretoken = $("[name=csrfmiddlewaretoken]").val()
                    },
                },
                "pageLength": 15,
                "ordering": false,
                "lengthChange": true,
                "searching": true,
                "paging": true,
                "columnDefs":[
                    //{"targets":[0,1,2,3,4],"visible":false,"searchable":false},
                    {"targets":0, "width":"5%"},
                    {"targets":1, "width":"25%"},
                    {"targets":2, "width":"20%"},
                    {"targets":3, "width":"25%"},
                    {"targets":4, "width":"25%"},
                ],
                "language": {
                    "lengthMenu": "Mostrando _MENU_ filas por página",
                    "zeroRecords": "No se encontraron resultados",
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "Mostrando página 0 de 0",
                    "infoFiltered": "(filtered from _MAX_ total records)",
                    "oPaginate": {
                        "sNext":     "Siguiente",
                        "sPrevious": "Anterior"
                    },
                }
            });

        // --- Repo de remesas
            var dt_repo_remesa = $('#dt_repo_remesa').DataTable( {
                "ajax": {
                    "url": "{%url 'repo_remesas' %}",
                    "type": "POST",
                    "data":  function( d ) {
                        d.csrfmiddlewaretoken = $("[name=csrfmiddlewaretoken]").val(),
                        d.fecha_desde= $("#panel_remesa").find("#fecha_desde").val(),
                        d.fecha_hasta=$("#panel_remesa").find("#fecha_hasta").val(),
                        d.usuario_id=$("#panel_remesa").find("#cmb_usuario").val()
                    },
                },
                "pageLength": 15,
                "ordering": false,
                "lengthChange": true,
                "searching": true,
                "paging": true,
                "columnDefs":[
                    {"targets":[0,10],"visible":false,"searchable":false},
                    {"targets":1, "width":"10%"},
                    {"targets":[2,3], "width":"15%"},
                    {"targets":[4,5,6,7,8,9], "width":"10%"},
                ],
                "language": {
                    "lengthMenu": "Mostrando _MENU_ filas por página",
                    "zeroRecords": "No se encontraron resultados",
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "Mostrando página 0 de 0",
                    "infoFiltered": "(filtered from _MAX_ total records)",
                    "oPaginate": {
                        "sNext":     "Siguiente",
                        "sPrevious": "Anterior"
                    },
                }
            });

             $("#filtrar_repo_remesa").on('click',function(){
                $("#dt_repo_remesa").DataTable().ajax.reload();
                $("#dt_repo_total").DataTable().ajax.reload();
           });

            var dt_repo_total = $('#dt_repo_total').DataTable( {
                "ajax": {
                    "url": "{%url 'repo_total' %}",
                    "type": "POST",
                    "data":  function( d ) {
                        d.csrfmiddlewaretoken = $("[name=csrfmiddlewaretoken]").val(),
                        d.fecha_desde= $("#panel_remesa").find("#fecha_desde").val(),
                        d.fecha_hasta=$("#panel_remesa").find("#fecha_hasta").val(),
                        d.usuario_id=$("#panel_remesa").find("#cmb_usuario").val()
                    },
                },
                "pageLength": 1,
                "ordering": false,
                "lengthChange": false,
                "searching": false,
                "paging": false,
                "columnDefs":[
                   // {"targets":[],"visible":false,"searchable":false},
                   // {"targets":1, "width":"10%"},
                    //{"targets":[2,3], "width":"15%"},
                    {"targets":[0,1,2,3], "width":"25%"},
                ],
                "language": {
                    "lengthMenu": "Mostrando _MENU_ filas por página",
                    "zeroRecords": "No se encontraron resultados",
                    "info": "Mostrando página _PAGE_ de _PAGES_",
                    "infoEmpty": "Mostrando página 0 de 0",
                    "infoFiltered": "(filtered from _MAX_ total records)",
                    "oPaginate": {
                        "sNext":     "Siguiente",
                        "sPrevious": "Anterior"
                    },
                }
            });
    });

</script>
{% endblock %}